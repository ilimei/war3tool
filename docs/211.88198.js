(self.webpackChunkwar3tool=self.webpackChunkwar3tool||[]).push([[211],{211:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BlpView:()=>C,default:()=>E}),n(467);var r,a,o=n(5673),i=(n(8136),n(5789)),c=(n(4314),n(8465)),s=n(7294),u=n(3690),l=n(6065);function f(e,t){return e.getUint32(4*t,!0)}function h(e,t,n){var r=8/t;return e[Math.floor(n*t/8)]>>r-n%r-1&(1<<t)-1}function p(e){var t=new DataView(e),n={type:r.BLP1,width:0,height:0,content:a.JPEG,alphaBits:0,mipmaps:[],data:e},o=function(e,t){return String.fromCharCode(e.getUint8(0),e.getUint8(1),e.getUint8(2),e.getUint8(3))}(t);if("BLP0"===o||"BLP2"===o)throw new Error("BLP0/BLP2 not supported");if("BLP1"!==o)throw new Error("Not a blp image");if(n.content=f(t,1),n.content!==a.JPEG&&n.content!==a.Direct)throw new Error("Unknown BLP content");n.alphaBits=f(t,2),n.width=f(t,3),n.height=f(t,4);for(var i=0;i<16;++i){var c={offset:f(t,7+i),size:f(t,23+i)};if(!(c.size>0))break;n.mipmaps.push(c)}return n}function m(e,t){var n=new DataView(e.data),r=new Uint8Array(e.data),o=e.mipmaps[t];if(e.content===a.JPEG){var i=f(n,39),c=new Uint8Array(i+o.size);return console.info("jpeg header size",i),c.set(r.subarray(160,160+i)),c.set(r.subarray(o.offset,o.offset+o.size),i),l(c)}for(var s=new Uint8Array(e.data,156,1024),u=e.width/(1<<t),p=e.height/(1<<t),m=u*p,d=new Uint8Array(e.data,o.offset+m,Math.ceil(m*e.alphaBits/8)),v=function(e,t){return"undefined"!=typeof ImageData?new ImageData(e,t):{width:e,height:t,data:new Uint8ClampedArray(e*t*4)}}(u,p),b=255/((1<<e.alphaBits)-1),w=0;w<m;++w){var y=4*n.getUint8(o.offset+w);v.data[4*w]=s[y+2],v.data[4*w+1]=s[y+1],v.data[4*w+2]=s[y],e.alphaBits>0?v.data[4*w+3]=h(d,e.alphaBits,w)*b:v.data[4*w+3]=255}return v}function d(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}!function(e){e[e.BLP0=0]="BLP0",e[e.BLP1=1]="BLP1",e[e.BLP2=2]="BLP2"}(r||(r={})),function(e){e[e.JPEG=0]="JPEG",e[e.Direct=1]="Direct"}(a||(a={}));const w=function(e){var t=e.file,n=(0,s.useRef)(null),r=v((0,s.useState)(0),2),a=r[0],o=r[1],i=v((0,s.useState)(0),2),c=i[0],u=i[1];return(0,s.useEffect)((function(){var e;(e=regeneratorRuntime.mark((function e(){var r,a,i,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.current){e.next=14;break}return r=n.current.getContext("2d"),e.next=4,t.arrayBuffer();case 4:return a=e.sent,i=p(a),console.info(i),o(i.width),u(i.height),c=m(i,0),e.next=12,createImageBitmap(c);case 12:s=e.sent,r.drawImage(s,0,0);case 14:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){d(o,r,a,i,c,"next",e)}function c(e){d(o,r,a,i,c,"throw",e)}i(void 0)}))})()}),[n.current,t]),s.createElement("canvas",{ref:n,width:a,height:c})};var y=n(4184),g=n.n(y),k=n(6443);function P(){return(P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function D(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var A=c.Z.Dragger,C=function(e){!function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(e);var t,n,r=L((0,s.useState)([]),2),a=r[0],c=r[1],l=L((0,s.useState)(0),2),f=l[0],h=l[1],p={name:"file",multiple:!0,showUploadList:!1,onChange:(t=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h(0),c(t.fileList.map((function(e){return e.originFileObj})));case 2:case"end":return e.stop()}}),e)})),n=function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(e){D(o,r,a,i,c,"next",e)}function c(e){D(o,r,a,i,c,"throw",e)}i(void 0)}))},function(e){return n.apply(this,arguments)}),beforeUpload:function(){return!1},onDrop:function(e){console.log("Dropped files",e.dataTransfer.files)}};return(0,s.useEffect)((function(){var e=function(e){switch(e.key){case"ArrowDown":h(Math.min(f+1,a.length-1));break;case"ArrowUp":h(Math.max(f-1,0))}};return window.addEventListener("keyup",e),function(){return window.removeEventListener("keyup",e)}}),[a,f]),s.createElement(A,P({fileList:[]},p),a.length>0?s.createElement(s.Fragment,null,s.createElement(o.Z,{onClick:function(e){return e.stopPropagation(),e.preventDefault()}},s.createElement(i.Z,{span:10,style:{width:300}},s.createElement(k.ZP,{height:400,overscanRowCount:20,noRowsRenderer:function(){return s.createElement("div",{style:{height:40}},"No rows")},rowCount:a.length,rowHeight:40,rowRenderer:function(e){var t=e.index,n=e.key,r=e.style;return s.createElement("div",{className:g()("blp-item",{isSelect:t===f}),key:n,style:r,onClick:function(e){e.stopPropagation(),e.preventDefault(),h(t)}},a[t].name)},scrollToIndex:f,width:300})),s.createElement(i.Z,{span:10},s.createElement(w,{file:a[f]})))):s.createElement(s.Fragment,null,s.createElement("p",{className:"ant-upload-drag-icon"},s.createElement(u.Z,null)),s.createElement("p",{className:"ant-upload-text"},"点击或者拖拽blp文件进来"),s.createElement("p",{className:"ant-upload-hint"},"支持拖拽多个文件进入")))};const E=C},6065:e=>{var t=function(){"use strict";var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),t=4017,n=799,r=3406,a=2276,o=1567,i=3784,c=5793,s=2896;function u(){}function l(e,t){for(var n,r,a=0,o=[],i=16;i>0&&!e[i-1];)i--;o.push({children:[],index:0});var c,s=o[0];for(n=0;n<i;n++){for(r=0;r<e[n];r++){for((s=o.pop()).children[s.index]=t[a];s.index>0;)s=o.pop();for(s.index++,o.push(s);o.length<=n;)o.push(c={children:[],index:0}),s.children[s.index]=c.children,s=c;a++}n+1<i&&(o.push(c={children:[],index:0}),s.children[s.index]=c.children,s=c)}return o[0].children}function f(e,t,n){return 64*((e.blocksPerLine+1)*t+n)}function h(t,n,r,a,o,i,c,s,u){r.precision,r.samplesPerLine,r.scanLines;var l=r.mcusPerLine,h=r.progressive,p=(r.maxH,r.maxV,n),m=0,d=0;function v(){if(d>0)return d--,m>>d&1;if(255==(m=t[n++])){var e=t[n++];if(e)throw"unexpected marker: "+(m<<8|e).toString(16)}return d=7,m>>>7}function b(e){for(var t,n=e;null!==(t=v());){if("number"==typeof(n=n[t]))return n;if("object"!=typeof n)throw"invalid huffman sequence"}return null}function w(e){for(var t=0;e>0;){var n=v();if(null===n)return;t=t<<1|n,e--}return t}function y(e){var t=w(e);return t>=1<<e-1?t:t+(-1<<e)+1}var g,k=0,P=0;function D(e,t,n,r,a){var o=n%l;t(e,f(e,(n/l|0)*e.v+r,o*e.h+a))}function L(e,t,n){t(e,f(e,n/e.blocksPerLine|0,n%e.blocksPerLine))}var x,A,C,E,B,U,I=a.length;U=h?0===i?0===s?function(e,t){var n=b(e.huffmanTableDC),r=0===n?0:y(n)<<u;e.blockData[t]=e.pred+=r}:function(e,t){e.blockData[t]|=v()<<u}:0===s?function(t,n){if(k>0)k--;else for(var r=i,a=c;r<=a;){var o=b(t.huffmanTableAC),s=15&o,l=o>>4;if(0!==s){var f=e[r+=l];t.blockData[n+f]=y(s)*(1<<u),r++}else{if(l<15){k=w(l)+(1<<l)-1;break}r+=16}}}:function(t,n){for(var r=i,a=c,o=0;r<=a;){var s=e[r];switch(P){case 0:var l=b(t.huffmanTableAC),f=15&l;if(o=l>>4,0===f)o<15?(k=w(o)+(1<<o),P=4):(o=16,P=1);else{if(1!==f)throw"invalid ACn encoding";g=y(f),P=o?2:3}continue;case 1:case 2:t.blockData[n+s]?t.blockData[n+s]+=v()<<u:0==--o&&(P=2==P?3:0);break;case 3:t.blockData[n+s]?t.blockData[n+s]+=v()<<u:(t.blockData[n+s]=g<<u,P=0);break;case 4:t.blockData[n+s]&&(t.blockData[n+s]+=v()<<u)}r++}4===P&&0==--k&&(P=0)}:function(t,n){var r=b(t.huffmanTableDC),a=0===r?0:y(r);t.blockData[n]=t.pred+=a;for(var o=1;o<64;){var i=b(t.huffmanTableAC),c=15&i,s=i>>4;if(0!==c){var u=e[o+=s];t.blockData[n+u]=y(c),o++}else{if(s<15)break;o+=16}}};var S,T,j,M,R=0;for(T=1==I?a[0].blocksPerLine*a[0].blocksPerColumn:l*r.mcusPerColumn,o||(o=T);R<T;){for(A=0;A<I;A++)a[A].pred=0;if(k=0,1==I)for(x=a[0],B=0;B<o;B++)L(x,U,R),R++;else for(B=0;B<o;B++){for(A=0;A<I;A++)for(j=(x=a[A]).h,M=x.v,C=0;C<M;C++)for(E=0;E<j;E++)D(x,U,R,C,E);R++}if(d=0,(S=t[n]<<8|t[n+1])<=65280)throw"marker was not found";if(!(S>=65488&&S<=65495))break;n+=2}return n-p}function p(e,u,l){var f,h,p,m,d,v,b,w,y,g,k=e.quantizationTable;for(g=0;g<64;g++)l[g]=e.blockData[u+g]*k[g];for(g=0;g<8;++g){var P=8*g;0!=l[1+P]||0!=l[2+P]||0!=l[3+P]||0!=l[4+P]||0!=l[5+P]||0!=l[6+P]||0!=l[7+P]?(f=c*l[0+P]+128>>8,h=c*l[4+P]+128>>8,p=l[2+P],m=l[6+P],d=s*(l[1+P]-l[7+P])+128>>8,w=s*(l[1+P]+l[7+P])+128>>8,v=l[3+P]<<4,b=l[5+P]<<4,y=f-h+1>>1,f=f+h+1>>1,h=y,y=p*i+m*o+128>>8,p=p*o-m*i+128>>8,m=y,y=d-b+1>>1,d=d+b+1>>1,b=y,y=w+v+1>>1,v=w-v+1>>1,w=y,y=f-m+1>>1,f=f+m+1>>1,m=y,y=h-p+1>>1,h=h+p+1>>1,p=y,y=d*a+w*r+2048>>12,d=d*r-w*a+2048>>12,w=y,y=v*n+b*t+2048>>12,v=v*t-b*n+2048>>12,b=y,l[0+P]=f+w,l[7+P]=f-w,l[1+P]=h+b,l[6+P]=h-b,l[2+P]=p+v,l[5+P]=p-v,l[3+P]=m+d,l[4+P]=m-d):(y=c*l[0+P]+512>>10,l[0+P]=y,l[1+P]=y,l[2+P]=y,l[3+P]=y,l[4+P]=y,l[5+P]=y,l[6+P]=y,l[7+P]=y)}for(g=0;g<8;++g){var D=g;0!=l[8+D]||0!=l[16+D]||0!=l[24+D]||0!=l[32+D]||0!=l[40+D]||0!=l[48+D]||0!=l[56+D]?(f=c*l[0+D]+2048>>12,h=c*l[32+D]+2048>>12,p=l[16+D],m=l[48+D],d=s*(l[8+D]-l[56+D])+2048>>12,w=s*(l[8+D]+l[56+D])+2048>>12,v=l[24+D],b=l[40+D],y=f-h+1>>1,f=f+h+1>>1,h=y,y=p*i+m*o+2048>>12,p=p*o-m*i+2048>>12,m=y,y=d-b+1>>1,d=d+b+1>>1,b=y,y=w+v+1>>1,v=w-v+1>>1,w=y,y=f-m+1>>1,f=f+m+1>>1,m=y,y=h-p+1>>1,h=h+p+1>>1,p=y,y=d*a+w*r+2048>>12,d=d*r-w*a+2048>>12,w=y,y=v*n+b*t+2048>>12,v=v*t-b*n+2048>>12,b=y,l[0+D]=f+w,l[56+D]=f-w,l[8+D]=h+b,l[48+D]=h-b,l[16+D]=p+v,l[40+D]=p-v,l[24+D]=m+d,l[32+D]=m-d):(y=c*l[g+0]+8192>>14,l[0+D]=y,l[8+D]=y,l[16+D]=y,l[24+D]=y,l[32+D]=y,l[40+D]=y,l[48+D]=y,l[56+D]=y)}for(g=0;g<64;++g){var L=u+g,x=l[g];x=x<=-2056?0:x>=2024?255:x+2056>>4,e.blockData[L]=x}}function m(e,t){for(var n=t.blocksPerLine,r=t.blocksPerColumn,a=new Int32Array(64),o=0;o<r;o++)for(var i=0;i<n;i++)p(t,f(t,o,i),a);return t.blockData}function d(e){return e<=0?0:e>=255?255:0|e}return u.prototype={load:function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){var e=new Uint8Array(t.response||t.mozResponseArrayBuffer);this.parse(e),this.onload&&this.onload()}.bind(this),t.send(null)},loadFromBuffer:function(e){this.parse(e),this.onload&&this.onload()},parse:function(t){function n(){var e=t[s]<<8|t[s+1];return s+=2,e}function r(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),n=Math.ceil(e.scanLines/8/e.maxV),r=0;r<e.components.length;r++){F=e.components[r];var a=Math.ceil(Math.ceil(e.samplesPerLine/8)*F.h/e.maxH),o=Math.ceil(Math.ceil(e.scanLines/8)*F.v/e.maxV),i=t*F.h,c=n*F.v*64*(i+1);F.blockData=new Int16Array(c),F.blocksPerLine=a,F.blocksPerColumn=o}e.mcusPerLine=t,e.mcusPerColumn=n}var a,o,i,c,s=0,u=(t.length,null),f=null,p=[],d=[],v=[],b=n();if(65496!=b)throw"SOI not found";for(b=n();65497!=b;){var w;switch(b){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var y=(i=void 0,c=void 0,i=n(),c=t.subarray(s,s+i-2),s+=c.length,c);65504===b&&74===y[0]&&70===y[1]&&73===y[2]&&70===y[3]&&0===y[4]&&(u={version:{major:y[5],minor:y[6]},densityUnits:y[7],xDensity:y[8]<<8|y[9],yDensity:y[10]<<8|y[11],thumbWidth:y[12],thumbHeight:y[13],thumbData:y.subarray(14,14+3*y[12]*y[13])}),65518===b&&65===y[0]&&100===y[1]&&111===y[2]&&98===y[3]&&101===y[4]&&0===y[5]&&(f={version:y[6],flags0:y[7]<<8|y[8],flags1:y[9]<<8|y[10],transformCode:y[11]});break;case 65499:for(var g=n()+s-2;s<g;){var k=t[s++],P=new Int32Array(64);if(k>>4==0)for(w=0;w<64;w++)P[e[w]]=t[s++];else{if(k>>4!=1)throw"DQT: invalid table spec";for(w=0;w<64;w++)P[e[w]]=n()}p[15&k]=P}break;case 65472:case 65473:case 65474:if(a)throw"Only single frame JPEGs supported";n(),(a={}).extended=65473===b,a.progressive=65474===b,a.precision=t[s++],a.scanLines=n(),a.samplesPerLine=n(),a.components=[],a.componentIds={};var D,L=t[s++],x=0,A=0;for(Z=0;Z<L;Z++){D=t[s];var C=t[s+1]>>4,E=15&t[s+1];x<C&&(x=C),A<E&&(A=E);var B=t[s+2],U=a.components.push({h:C,v:E,quantizationTable:p[B]});a.componentIds[D]=U-1,s+=3}a.maxH=x,a.maxV=A,r(a);break;case 65476:var I=n();for(Z=2;Z<I;){var S=t[s++],T=new Uint8Array(16),j=0;for(w=0;w<16;w++,s++)j+=T[w]=t[s];var M=new Uint8Array(j);for(w=0;w<j;w++,s++)M[w]=t[s];Z+=17+j,(S>>4==0?v:d)[15&S]=l(T,M)}break;case 65501:n(),o=n();break;case 65498:n();var R=t[s++],O=[];for(Z=0;Z<R;Z++){var z=a.componentIds[t[s++]];F=a.components[z];var G=t[s++];F.huffmanTableDC=v[G>>4],F.huffmanTableAC=d[15&G],O.push(F)}var H=t[s++],V=t[s++],J=t[s++],N=h(t,s,a,O,o,H,V,J>>4,15&J);s+=N;break;default:if(255==t[s-3]&&t[s-2]>=192&&t[s-2]<=254){s-=3;break}throw"unknown JPEG marker "+b.toString(16)}b=n()}this.width=a.samplesPerLine,this.height=a.scanLines,this.jfif=u,this.adobe=f,this.components=[];for(var Z=0;Z<a.components.length;Z++){var F=a.components[Z];this.components.push({output:m(0,F),scaleX:F.h/a.maxH,scaleY:F.v/a.maxV,blocksPerLine:F.blocksPerLine,blocksPerColumn:F.blocksPerColumn})}},getData:function(e,t,n){var r,a,o,i,c,s,u=this.width/t,l=this.height/n,h=0,p=this.components.length,m=e.data,d=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(s=0;s<p;s++){for(var v,b,w,y=(r=this.components[s<3?2-s:s]).blocksPerLine,g=r.blocksPerColumn,k=y<<3,P=0,D=0;D<g;D++)for(var L=D<<3,x=0;x<y;x++){var A=f(r,D,x),C=(h=0,x<<3);for(v=0;v<8;v++)for(P=(L+v)*k,b=0;b<8;b++)d[P+C+b]=r.output[A+h++]}for(a=r.scaleX*u,o=r.scaleY*l,h=s,c=0;c<n;c++)for(i=0;i<t;i++)w=(0|c*o)*k+(0|i*a),m[h]=d[w],h+=p}return m},copyToImageData:function(e){var t,n,r,a,o,i,c,s,u=e.width,l=e.height,f=u*l*4,h=e.data,p=this.getData(u,l),m=0,v=0;switch(this.components.length){case 1:for(;v<f;)r=p[m++],h[v++]=r,h[v++]=r,h[v++]=r,h[v++]=255;break;case 3:for(;v<f;)i=p[m++],c=p[m++],s=p[m++],h[v++]=i,h[v++]=c,h[v++]=s,h[v++]=255;break;case 4:for(;v<f;)a=p[m++],o=p[m++],r=p[m++],i=d((t=255-p[m++])-a*(n=t/255)),c=d(t-o*n),s=d(t-r*n),h[v++]=i,h[v++]=c,h[v++]=s,h[v++]=255;break;default:throw"Unsupported color mode"}}},u}();e.exports=function(e){const n=new t;var r;return n.loadFromBuffer(e),r="undefined"!=typeof ImageData?new ImageData(n.width,n.height):{width:n.width,height:n.height,data:new Uint8ClampedArray(n.width*n.height*4)},n.getData(r,n.width,n.height),r}}}]);